# Medical-Injury-tracker

User Could Add injury report contain the reporter name and the date of injury 
with injury list of injuries area and description also user can edit previus Report
and delete spacifc injury or add injury also could delete a whole Report 

## Table of Contents

- [Getting Started](#getting-started)
  - [Prerequisites](#prerequisites)
  - [Installation](#installation)
- [Usage](#usage)
- [Folder Structure](#folder-structure)
- [Technologies Used](#technologies-used)

## Getting Started

### Prerequisites

- [Node.js](https://nodejs.org/)
- [npm](https://www.npmjs.com/) or [Yarn](https://yarnpkg.com/)

### Installation

1. Clone the repository:

   ```
   bashgit clone https://github.com/kirellos-emad1/medicl-injury-tracker.git
   cd medicl injury tracker
   cd your-repo
   npm install or yarn  
   ```
## Usage
set the Enveounment varible
as like this
PP# You can get a hosted PostgreSQL Database using Heroku, Digital Ocean
DATABASE_URL=""
# can be generated by running `openssl rand -hex 32`
AUTH0_SECRET =''

# Can be found in the App settings
AUTH0_BASE_URL='http://localhost:3000'
AUTH0_ISSUER_BASE_URL=''
AUTH0_CLIENT_ID = ''
AUTH0_CLIENT_SECRET = ''

# change `http://localhost:3000` to the domain of your app in production
AUTH0_CALLBACK_URL = 'http://localhost:3000/api/auth/callback'
# To be sent to the /api/auth/hook endpoint to add users to the database
AUTH0_HOOK_SECRET = ''

then generate prisma 
``` npx prisma generate```

after this set up a auth0 profile 
set the env with it 

then make a Action to save the user Email in prisma data base 
first add env name AUTH0_HOOK_SECRET to the action and make sure the value 
equal the value in your .env file

then add dependnce for Node-fetch version 2.6.1

after that add this block of code to the action

const fetch =require('node-fetch')

exports.onExecutePostLogin = async (event, api) => {
  const SECRET = event.secrets.AUTH0_HOOK_SECRET
```  
  if (event.user.app_metadata.localUserCreated) {
    return
  }

  const email = event.user.email
  const name = event.user.username
  
  const request = await fetch('URL', { 
    method: 'POST',
    body: JSON.stringify({ email,name, secret: SECRET }),
    headers: { 'Content-Type': 'application/json' },
  })
  const response = await request.json()
   api.user.setAppMetadata('localUserCreated', true)
}
```
replace URL with yours if you run app on local use Ngrok 
set up account then type in termnal this command ``` npx ngrok http 3000 --authtoken "TOKEN" ``` 
replace token with your Ngrok token

modefiy schema prisma to be like this 
```
datasource db {
  provider          = "postgresql"
  url               = env("DATABASE_URL")
}
```


Make sure to un comment the types and schema form graphql and remove the types in builder function its for deployment sake only

After all of that Run ```npm dev```

to interact with the app

## Foulder Structuer
- components
  - CreateReportModel.tsx
  - DeleteModel.tsx
  - EditReportModel.tsx
  - Footer.tsx
  - Header.tsx
  - InjuryFormFields.tsx
  - InjuryListFields.tsx
  - InjuryListTable.tsx
  - Loading.tsx
  - MeanContent.tsx
- graphql
  - types
    - index.ts
    - Injury.ts
    - InjuryList.ts
    - User.ts
  - builder.ts
  - context.ts
  - schema.ts
- lib
  - apollo.ts
  - prisma.ts
- page
  - api
      - auth
        -[...auth0].ts
        hook.ts
    - graphql.ts
  - _app.tsx
  - document.tsx
  - index.tsx
- prisma
   - schema.prisma
   - seed.ts
 


## Technologies Used
- prisma ORM
- Next.js
- TypeScript
- Apollo
- Graphql
- Auth0

